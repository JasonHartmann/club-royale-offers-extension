<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Download Club Royale Extension</title>
  <style>
    /* Make the page allow scrolling when content is taller than the viewport.
       Use min-height instead of fixed 100vh, top padding for comfortable spacing,
       and make the card itself scrollable when needed. */
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, sans-serif; background:#f8fafc; color:#0f172a; display:flex; align-items:flex-start; justify-content:center; min-height:100vh; margin:0; padding:24px; box-sizing:border-box; }
    .card { background:white; padding:24px; border-radius:10px; box-shadow:0 4px 18px rgba(15,23,42,0.08); max-width:520px; width: min(92vw, 520px); text-align:center; max-height: calc(100vh - 48px); overflow:auto; -webkit-overflow-scrolling:touch; box-sizing:border-box; }
    a.btn { display:inline-block; padding:12px 18px; background:#0a4d8c; color:#fff; border-radius:8px; text-decoration:none; font-weight:600; }
    p { margin-top:12px; color:#334155; }
    /* Ensure images inside the instructions don't expand the card beyond viewport */
    .instructions img { max-width:100%; height:auto; display:block; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Download Club Royale Extension</h1>
    <p>Click the button below to download the ZIP file.</p>
    <p><a class="btn" id="downloadBtn" href="https://comproyale.com/club-royal-offers-extension.zip" target="_blank" rel="noopener">Download ZIP</a></p>
    <p style="font-size:.85rem;color:#64748b;">If your browser blocks direct installation of ZIP files, save the file and follow your browser's developer extension install instructions.</p>

    <!-- Manual install instructions inserted per user request -->
    <div class="instructions" style="text-align:left;margin-top:18px;">
      <hr style="border:none;border-top:1px solid #eef2f7;margin:18px 0;" />
      <h2 style="font-size:1.05rem;margin:0 0 8px;">Manual install instructions</h2>
      <ol style="margin:0 0 12px 18px;padding:0;color:#334155;">
        <li style="margin-bottom:12px;">In Chrome, go to Manage Extensions:
          <div style="margin-top:8px;"><img src="step1.png" alt="Open Extensions page" style="max-width:100%;height:auto;border:1px solid #e6eaf0;border-radius:6px;" /></div>
        </li>
        <li style="margin-bottom:12px;">Enable "Developer Mode".
          <div style="margin-top:8px;"><img src="step2.png" alt="Enable Developer Mode" style="max-width:100%;height:auto;border:1px solid #e6eaf0;border-radius:6px;" /></div>
        </li>
        <li style="margin-bottom:12px;">Then, simply drag the downloaded ZIP file onto this extensions page:
          <div style="margin-top:8px;"><img src="step3.png" alt="Drag ZIP to page" style="max-width:100%;height:auto;border:1px solid #e6eaf0;border-radius:6px;" /></div>
        </li>
      </ol>
      <p style="font-weight:700;color:#0f172a;margin-top:6px;">You should also disable the old version of the extension while you're here.</p>
    </div>
    <!-- End inserted instructions -->
  </div>

  <script>
    (function(){
      const btn = document.getElementById('downloadBtn');
      if (!btn) return;
      const url = btn.getAttribute('href');
      const filename = (url && url.split('/').pop()) || 'club-royale-offers-extension.ZIP';
      async function fetchAndDownload(ev) {
        ev.preventDefault();
        try {
          btn.setAttribute('aria-disabled','true');
          btn.style.opacity = '0.8';
          btn.textContent = 'Downloading...';
          const controller = new AbortController();
          const timeout = setTimeout(() => controller.abort(), 30000); // 30s timeout
          const res = await fetch(url, { signal: controller.signal, cache: 'no-store' });
          clearTimeout(timeout);
          if (!res.ok) {
            console.warn('Network response was not ok: ' + res.status);
            // Fallback: open the original URL so user can download manually
            try { window.open(url, '_blank', 'noopener'); } catch(e) { window.location.href = url; }
            btn.textContent = 'Download (fallback)';
            setTimeout(() => { btn.textContent = 'Download ZIP'; btn.style.opacity=''; btn.removeAttribute('aria-disabled'); }, 1800);
            return;
          }
          const blob = await res.blob();
          const blobUrl = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = blobUrl;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          // Revoke after a bit to ensure download started
          setTimeout(() => URL.revokeObjectURL(blobUrl), 2000);
          btn.textContent = 'Download started';
          setTimeout(() => { btn.textContent = 'Download ZIP'; btn.style.opacity=''; btn.removeAttribute('aria-disabled'); }, 1800);
        } catch (err) {
          // If fetch fails (CORS, network, abort), fallback to opening the link in a new tab
          console.warn('ZIP fetch/download failed; opening original URL as fallback', err);
          try { window.open(url, '_blank', 'noopener'); } catch(e){ window.location.href = url; }
          btn.textContent = 'Download (fallback)';
          setTimeout(() => { btn.textContent = 'Download ZIP'; btn.style.opacity=''; btn.removeAttribute('aria-disabled'); }, 1800);
        }
      }
      btn.addEventListener('click', fetchAndDownload);
    })();
  </script>
</body>
</html>
